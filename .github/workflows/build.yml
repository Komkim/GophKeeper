name: Build

on:
  push:
    branches: [master]

jobs:
  build fileserver:
    runs-on: ubuntu-latest
    container: golang:1.19

    steps:

      - name: Checkout
        uses: actions/checkout@v3

      - name: Build fileserver
        run: |
          cd fileserver/cmd
          go build -o filserver -buildvcs=false

  test:
    needs: [build fileserver]
    runs-on: ubuntu-latest
    container: golang:1.19

    steps:

      - name: Checkout
        uses: actions/checkout@v3

      - name: Test fileserver
        run: |
          go test fileserver/... -cover

  lint:
    needs: [build fileserver]
    runs-on: ubuntu-latest
    container: golang:1.19

    steps:

      - name: Checkout
        uses: actions/checkout@v3

      - name: lint fileserver
        run: |
          go vet -vettool=$(which statictest) fileserver/...
#
#  build cliclient:
#    runs-on: ubuntu-latest
#    container: golang:1.19
#
#    steps:
#
#      - name: Checkout
#        uses: actions/checkout@v3
#
#      - name: Build fileserver
#        run: |
#          cd cliclient/cmd
#          go build -o cliclient -buildvcs=false
#
#    test:
#      needs: [build cliclient]
#      runs-on: ubuntu-latest
#      container: golang:1.19
#
#      steps:
#
#        - name: Checkout
#          uses: actions/checkout@v3
#
#        - name: Test cliclient
#          run: |
#            go test cliclient/... -cover
#
#    lint:
#      needs: [build fileserver]
#      runs-on: ubuntu-latest
#      container: golang:1.19
#
#      steps:
#
#        - name: Checkout
#          uses: actions/checkout@v3
#
#        - name: lint fileserver
#          run: |
#            go vet -vettool=$(which statictest) cliclient/...
#
#  build authserver:
#    runs-on: ubuntu-latest
#    container: golang:1.19
#
#    steps:
#
#      - name: Checkout
#        uses: actions/checkout@v3
#
#      - name: Build authserver
#        run: |
#          cd authserver/cmd
#          go build -o authserver -buildvcs=false
#
#    test:
#      needs: [build authserver]
#      runs-on: ubuntu-latest
#      container: golang:1.19
#
#      steps:
#
#        - name: Checkout
#          uses: actions/checkout@v3
#
#        - name: Test authserver
#          run: |
#            go test authserver/... -cover
#
#    lint:
#      needs: [build authserver]
#      runs-on: ubuntu-latest
#      container: golang:1.19
#
#      steps:
#
#        - name: Checkout
#          uses: actions/checkout@v3
#
#        - name: lint authserver
#          run: |
#            go vet -vettool=$(which statictest) authserver/...
#
#  build keepserver:
#    runs-on: ubuntu-latest
#    container: golang:1.19
#
#    steps:
#
#      - name: Checkout
#        uses: actions/checkout@v3
#
#      - name: Build keepserver
#        run: |
#          cd keepserver/cmd
#          go build -o keepserver -buildvcs=false
#
#    test:
#      needs: [build keepserver]
#      runs-on: ubuntu-latest
#      container: golang:1.19
#
#      steps:
#
#        - name: Checkout
#          uses: actions/checkout@v3
#
#        - name: Test keepserver
#          run: |
#            go test keepserver/... -cover
#
#    lint:
#      needs: [build keepserver]
#      runs-on: ubuntu-latest
#      container: golang:1.19
#
#      steps:
#
#        - name: Checkout
#          uses: actions/checkout@v3
#
#        - name: lint keepserver
#          run: |
#            go vet -vettool=$(which statictest) keepserver/...